#!/bin/bash

# Caddie.sh - Git Prompt and Custom File Management
# This file handles git prompt setup and custom file sourcing

# Main registration function for git module
git_register() {
    git_help_register
    git_commands_register
}

# Register help information
git_help_register() {
    caddie_help_append "git" "Git prompt and custom file management"
}

# Register commands
git_commands_register() {
    caddie_commands_append "git:setup|caddie_git_setup_prompt|Setup Git prompt and custom files"
    caddie_commands_append "git:source|caddie_source_custom_files|Source custom bash files"
}

# Function to setup bash-git-prompt
caddie_git_setup_prompt() {
    # Due to catalina switching to zsh
    export BASH_SILENCE_DEPRECATION_WARNING=1
    
    # Set basic prompt
    export PS1="\u@\h:\w> "
    export EDITOR=vim
    
    # Note: We're using our custom colored prompt instead of bash-git-prompt
    # This provides better control and consistent behavior
    
    # Set up a simple custom prompt with caddie version and git info
    export PS1='$(caddie_prompt)'
}

# Function to source custom files
caddie_source_custom_files() {
    # Source custom bash profile additions
    if [ -f "$HOME/.bash_profile-caddie-custom" ]; then
        # shellcheck disable=SC1091
        source "$HOME/.bash_profile-caddie-custom"
    fi
    
    # Source custom bashrc additions
    if [ -f "$HOME/.bashrc-custom" ]; then
        # shellcheck disable=SC1091
        source "$HOME/.bashrc-custom"
    fi
}

# Auto-setup when sourced
caddie_git_setup_prompt
caddie_source_custom_files

# Export functions for external use
export -f caddie_git_setup_prompt
export -f caddie_source_custom_files
