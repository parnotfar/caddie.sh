#!/bin/bash

# Caddie.sh - Cross-Language Features
# This file contains cross-language development functions

# Source CLI module for formatting
source "$HOME/.caddie_modules/.caddie_cli"

# Function to show all environment status
function caddie_cross_env_status() {
    caddie cli:title "Development Environment Status"
    caddie cli:blank
    
    # Python status
    caddie cli:snake "Python:"
    if command -v python3 >/dev/null 2>&1; then
        caddie cli:check "Python $(python3 --version | cut -d' ' -f2)"
        if command -v pip >/dev/null 2>&1; then
            caddie cli:check "pip $(pip --version | cut -d' ' -f2)"
        fi
        if [ -n "$VIRTUAL_ENV" ]; then
            caddie cli:check "Virtual environment: $(basename "$VIRTUAL_ENV")"
        fi
    else
        caddie cli:x "Python not found"
    fi
    caddie cli:blank
    
    # Rust status
    caddie cli:crab "Rust:"
    if command -v rustc >/dev/null 2>&1; then
        caddie cli:check "Rust $(rustc --version | cut -d' ' -f2)"
        if command -v cargo >/dev/null 2>&1; then
            caddie cli:check "Cargo $(cargo --version | cut -d' ' -f2)"
        fi
    else
        caddie cli:x "Rust not found"
    fi
    caddie cli:blank
    
    # Node.js status
    caddie cli:package "Node.js:"
    if command -v node >/dev/null 2>&1; then
        caddie cli:check "Node.js $(node --version)"
        if command -v npm >/dev/null 2>&1; then
            caddie cli:check "npm $(npm --version)"
        fi
    else
        caddie cli:x "Node.js not found"
    fi
    caddie cli:blank
    
    # iOS status
    caddie cli:rocket "iOS Development:"
    if command -v xcodebuild >/dev/null 2>&1; then
        caddie cli:check "Xcode $(xcodebuild -version | head -n1 | cut -d' ' -f2)"
        if command -v swift >/dev/null 2>&1; then
            caddie cli:check "Swift $(swift --version | head -n1 | cut -d' ' -f3)"
        fi
        if command -v pod >/dev/null 2>&1; then
            caddie cli:check "CocoaPods $(pod --version)"
        fi
    else
        caddie cli:x "Xcode not found"
    fi
    caddie cli:blank
    
    # Git status
    caddie cli:git "Git:"
    if command -v git >/dev/null 2>&1; then
        caddie cli:check "Git $(git --version | cut -d' ' -f3)"
    else
        caddie cli:x "Git not found"
    fi
    caddie cli:blank
    
    # Docker status
    caddie cli:whale "Docker:"
    if command -v docker >/dev/null 2>&1; then
        caddie cli:check "Docker $(docker --version | cut -d' ' -f3 | cut -d',' -f1)"
    else
        caddie cli:x "Docker not found"
    fi
    return 0
}

# Function to setup development environment
function caddie_cross_env_setup() {
    caddie cli:title "Setting up development environment..."
    
    # Check for Homebrew
    if ! command -v brew >/dev/null 2>&1; then
        caddie cli:beer "Installing Homebrew..."
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    fi
    
    # Update Homebrew
    caddie cli:rotate "Updating Homebrew..."
    brew update
    
    # Install common development tools
    caddie cli:wrench "Installing development tools..."
    brew install git python3 node rust
    
    # Install Python virtualenv
    caddie cli:snake "Installing Python virtualenv..."
    pip3 install virtualenv
    
    # Install Node.js tools
    caddie cli:package "Installing Node.js tools..."
    npm install -g npm@latest
    
    caddie cli:check "Development environment setup complete"
    return 0
}

# Function to reset all environments
function caddie_cross_env_reset() {
    caddie cli:title "Resetting all development environments..."
    
    # Deactivate Python virtual environment
    if [ -n "$VIRTUAL_ENV" ]; then
        caddie cli:snake "Deactivating Python virtual environment..."
        deactivate
    fi
    
    # Clean Rust build artifacts
    if [ -f "Cargo.toml" ]; then
        caddie cli:crab "Cleaning Rust build artifacts..."
        cargo clean
    fi
    
    # Clean Node.js node_modules
    if [ -f "package.json" ]; then
        caddie cli:package "Removing Node.js dependencies..."
        rm -rf node_modules/
    fi
    
    # Clean iOS build artifacts
    if [ -f "*.xcodeproj" ] || [ -f "*.xcworkspace" ]; then
        caddie cli:rocket "Cleaning iOS build artifacts..."
        rm -rf build/
    fi
    
    caddie cli:check "All environments reset"
    return 0
}

# Function to backup current configurations
function caddie_cross_env_backup() {
    local backup_dir="$HOME/.caddie-backups/$(date +%Y%m%d_%H%M%S)"
    
    caddie cli:save "Creating backup in $backup_dir..."
    mkdir -p "$backup_dir"
    
    # Backup Python virtual environments
    if [ -d "$HOME/.virtualenvs" ]; then
        caddie cli:snake "Backing up Python virtual environments..."
        cp -r "$HOME/.virtualenvs" "$backup_dir/"
    fi
    
    # Backup Rust toolchain
    if [ -d "$HOME/.rustup" ]; then
        caddie cli:crab "Backing up Rust toolchain..."
        cp -r "$HOME/.rustup" "$backup_dir/"
    fi
    
    # Backup Node.js global packages
    if command -v npm >/dev/null 2>&1; then
        caddie cli:package "Backing up Node.js global packages..."
        npm list -g --depth=0 > "$backup_dir/npm-global-packages.txt"
    fi
    
    # Backup shell configurations
    caddie cli:folder "Backing up shell configurations..."
    cp "$HOME/.bashrc" "$backup_dir/" 2>/dev/null || true
    cp "$HOME/.bash_profile" "$backup_dir/" 2>/dev/null || true
    cp "$HOME/.zshrc" "$backup_dir/" 2>/dev/null || true
    
    caddie cli:check "Backup created: $backup_dir"
    return 0
}

# Function to list available templates
function caddie_cross_template_list() {
    caddie cli:title "Available Project Templates"
    caddie cli:blank
    caddie cli:title "Web Development:"
    caddie cli:indent "web          - Full-stack web application"
    caddie cli:indent "api          - REST API with documentation"
    caddie cli:blank
    caddie cli:title "Mobile Development:"
    caddie cli:indent "mobile       - Cross-platform mobile app"
    caddie cli:indent "app          - iOS app"
    caddie cli:indent "framework    - iOS framework"
    caddie cli:indent "extension    - iOS app extension"
    caddie cli:blank
    caddie cli:title "Data & ML:"
    caddie cli:indent "data         - Data analysis project"
    caddie cli:indent "ml           - Machine learning project"
    caddie cli:blank
    caddie cli:title "General:"
    caddie cli:indent "cli          - Command-line tool"
    caddie cli:indent "lib          - Library/package"
    caddie cli:indent "wasm         - WebAssembly project"
    caddie cli:blank
    caddie cli:usage "caddie template:create <type> <name>"
    return 0
}

# Function to create project from template
function caddie_cross_template_create() {
    local template_type="$1"
    local project_name="$2"
    
    if [ -z "$template_type" ] || [ -z "$project_name" ]; then
        caddie cli:red "Error: Please provide template type and project name"
        caddie cli:usage "caddie template:create <type> <name>"
        caddie cli:thought "Use 'caddie template:list' to see available templates"
        return 1
    fi
    
    if [ -d "$project_name" ]; then
        caddie cli:red "Error: Directory '$project_name' already exists"
        return 1
    fi
    
    caddie cli:title "Creating $template_type project '$project_name'..."
    
    case "$template_type" in
        "web")
            caddie_cross_template_web "$project_name"
            ;;
        "api")
            caddie_cross_template_api "$project_name"
            ;;
        "mobile")
            caddie_cross_template_mobile "$project_name"
            ;;
        "app")
            caddie_cross_template_ios_app "$project_name"
            ;;
        "framework")
            caddie_cross_template_ios_framework "$project_name"
            ;;
        "extension")
            caddie_cross_template_ios_extension "$project_name"
            ;;
        "data")
            caddie_cross_template_data "$project_name"
            ;;
        "ml")
            caddie_cross_template_ml "$project_name"
            ;;
        "cli")
            caddie_cross_template_cli "$project_name"
            ;;
        "lib")
            caddie_cross_template_lib "$project_name"
            ;;
        "wasm")
            caddie_cross_template_wasm "$project_name"
            ;;
        *)
            caddie cli:red "Error: Unknown template type '$template_type'"
            caddie cli:thought "Use 'caddie template:list' to see available templates"
            return 1
            ;;
    esac
    return 0
}

# Template creation functions
function caddie_cross_template_web() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create basic web structure
    mkdir -p src/{components,pages,styles,utils}
    mkdir -p public
    mkdir -p tests
    
    # Create package.json
    cat > package.json << EOF
{
  "name": "$name",
  "version": "1.0.0",
  "description": "A modern web application",
  "main": "src/index.js",
  "scripts": {
    "start": "npm run dev",
    "dev": "vite",
    "build": "vite build",
    "test": "jest",
    "lint": "eslint src/",
    "format": "prettier --write src/"
  },
  "dependencies": {
    "react": "^18.0.0",
    "react-dom": "^18.0.0"
  },
  "devDependencies": {
    "vite": "^4.0.0",
    "jest": "^29.0.0",
    "eslint": "^8.0.0",
    "prettier": "^2.0.0"
  }
}
EOF
    
    # Create basic files
    touch src/index.js
    touch src/App.js
    touch public/index.html
    touch README.md
    touch .gitignore
    
    caddie cli:check "Web project '$name' created"
    return 0
}

function caddie_cross_template_api() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create API structure
    mkdir -p src/{controllers,models,routes,middleware}
    mkdir -p tests
    mkdir -p docs
    
    # Create package.json
    cat > package.json << EOF
{
  "name": "$name",
  "version": "1.0.0",
  "description": "A REST API",
  "main": "src/server.js",
  "scripts": {
    "start": "node src/server.js",
    "dev": "nodemon src/server.js",
    "test": "jest",
    "lint": "eslint src/",
    "format": "prettier --write src/"
  },
  "dependencies": {
    "express": "^4.18.0",
    "cors": "^2.8.5",
    "helmet": "^6.0.0"
  },
  "devDependencies": {
    "nodemon": "^2.0.0",
    "jest": "^29.0.0",
    "eslint": "^8.0.0",
    "prettier": "^2.0.0"
  }
}
EOF
    
    # Create basic files
    touch src/server.js
    touch src/routes/index.js
    touch README.md
    touch .gitignore
    
    caddie cli:check "API project '$name' created"
    return 0
}

function caddie_cross_template_mobile() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create React Native structure
    mkdir -p src/{components,screens,navigation,services}
    mkdir -p android
    mkdir -p ios
    
    # Create package.json
    cat > package.json << EOF
{
  "name": "$name",
  "version": "1.0.0",
  "description": "A React Native mobile app",
  "main": "index.js",
  "scripts": {
    "start": "react-native start",
    "android": "react-native run-android",
    "ios": "react-native run-ios",
    "test": "jest",
    "lint": "eslint src/"
  },
  "dependencies": {
    "react": "18.2.0",
    "react-native": "0.72.0"
  },
  "devDependencies": {
    "jest": "^29.0.0",
    "eslint": "^8.0.0"
  }
}
EOF
    
    # Create basic files
    touch index.js
    touch src/App.js
    touch README.md
    touch .gitignore
    
    caddie cli:check "Mobile project '$name' created"
    return 0
}

function caddie_cross_template_ios_app() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create iOS app structure
    mkdir -p "$name"{,Tests,UITests}
    mkdir -p "$name/Resources"
    
    # Create basic files
    touch "$name/AppDelegate.swift"
    touch "$name/ViewController.swift"
    touch "$name/Info.plist"
    touch README.md
    
    caddie cli:check "iOS app '$name' created"
    return 0
}

function caddie_cross_template_ios_framework() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create iOS framework structure
    mkdir -p "$name"{,Tests}
    mkdir -p "$name/Resources"
    
    # Create basic files
    touch "$name/$name.swift"
    touch "$name/Info.plist"
    touch README.md
    
    caddie cli:check "iOS framework '$name' created"
    return 0
}

function caddie_cross_template_ios_extension() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create iOS extension structure
    mkdir -p "$name"{,Tests}
    mkdir -p "$name/Resources"
    
    # Create basic files
    touch "$name/ExtensionViewController.swift"
    touch "$name/Info.plist"
    touch README.md
    
    caddie cli:check "iOS extension '$name' created"
    return 0
}

function caddie_cross_template_data() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create data analysis structure
    mkdir -p {data,notebooks,src,reports}
    mkdir -p data/{raw,processed}
    
    # Create requirements.txt
    cat > requirements.txt << EOF
pandas>=1.5.0
numpy>=1.21.0
matplotlib>=3.5.0
seaborn>=0.11.0
jupyter>=1.0.0
scipy>=1.9.0
EOF
    
    # Create basic files
    touch notebooks/analysis.ipynb
    touch src/data_processing.py
    touch README.md
    touch .gitignore
    
    caddie cli:check "Data project '$name' created"
    return 0
}

function caddie_cross_template_ml() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create ML structure
    mkdir -p {data,models,src,notebooks,reports}
    mkdir -p data/{raw,processed}
    mkdir -p models/{trained,checkpoints}
    
    # Create requirements.txt
    cat > requirements.txt << EOF
pandas>=1.5.0
numpy>=1.21.0
scikit-learn>=1.1.0
tensorflow>=2.10.0
torch>=1.12.0
jupyter>=1.0.0
matplotlib>=3.5.0
seaborn>=0.11.0
EOF
    
    # Create basic files
    touch notebooks/experiments.ipynb
    touch src/train.py
    touch src/predict.py
    touch README.md
    touch .gitignore
    
    caddie cli:check "ML project '$name' created"
    return 0
}

function caddie_cross_template_cli() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create CLI structure
    mkdir -p src
    mkdir -p tests
    
    # Create package.json
    cat > package.json << EOF
{
  "name": "$name",
  "version": "1.0.0",
  "description": "A command-line tool",
  "main": "src/index.js",
  "bin": {
    "$name": "src/index.js"
  },
  "scripts": {
    "start": "node src/index.js",
    "test": "jest",
    "lint": "eslint src/"
  },
  "dependencies": {
    "commander": "^9.0.0",
    "chalk": "^4.1.0"
  },
  "devDependencies": {
    "jest": "^29.0.0",
    "eslint": "^8.0.0"
  }
}
EOF
    
    # Create basic files
    touch src/index.js
    touch README.md
    touch .gitignore
    
    caddie cli:check "CLI project '$name' created"
    return 0
}

function caddie_cross_template_lib() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create library structure
    mkdir -p src
    mkdir -p tests
    mkdir -p docs
    
    # Create package.json
    cat > package.json << EOF
{
  "name": "$name",
  "version": "1.0.0",
  "description": "A JavaScript library",
  "main": "src/index.js",
  "scripts": {
    "build": "rollup -c",
    "test": "jest",
    "lint": "eslint src/",
    "docs": "jsdoc src/ -d docs/"
  },
  "dependencies": {},
  "devDependencies": {
    "rollup": "^2.0.0",
    "jest": "^29.0.0",
    "eslint": "^8.0.0",
    "jsdoc": "^3.6.0"
  }
}
EOF
    
    # Create basic files
    touch src/index.js
    touch README.md
    touch .gitignore
    
    caddie cli:check "Library project '$name' created"
    return 0
}

function caddie_cross_template_wasm() {
    local name="$1"
    mkdir -p "$name"
    cd "$name" || exit
    
    # Create WebAssembly structure
    mkdir -p src
    mkdir -p tests
    mkdir -p dist
    
    # Create package.json
    cat > package.json << EOF
{
  "name": "$name",
  "version": "1.0.0",
  "description": "A WebAssembly project",
  "main": "dist/index.js",
  "scripts": {
    "build": "wasm-pack build",
    "test": "wasm-pack test",
    "dev": "wasm-pack build --dev"
  },
  "dependencies": {},
  "devDependencies": {
    "wasm-pack": "^0.10.0"
  }
}
EOF
    
    # Create Cargo.toml
    cat > Cargo.toml << EOF
[package]
name = "$name"
version = "0.1.0"
edition = "2021"

[lib]
crate-type = ["cdylib"]

[dependencies]
wasm-bindgen = "0.2"
EOF
    
    # Create basic files
    touch src/lib.rs
    touch README.md
    touch .gitignore
    
    caddie cli:check "WebAssembly project '$name' created"
    return 0
}

# Build functions
function caddie_cross_build_all() {
    caddie cli:title "Building all projects..."
    
    # Build Python
    if [ -f "setup.py" ] || [ -f "pyproject.toml" ]; then
        caddie cli:snake "Building Python project..."
        caddie_cross_build_python
    fi
    
    # Build Rust
    if [ -f "Cargo.toml" ]; then
        caddie cli:crab "Building Rust project..."
        caddie_cross_build_rust
    fi
    
    # Build iOS
    if [ -f "*.xcodeproj" ] || [ -f "*.xcworkspace" ]; then
        caddie cli:rocket "Building iOS project..."
        caddie_cross_build_ios
    fi
    
    caddie cli:check "All projects built"
    return 0
}

function caddie_cross_build_python() {
    if [ -f "setup.py" ]; then
        caddie cli:snake "Building Python package..."
        python setup.py build
    elif [ -f "pyproject.toml" ]; then
        caddie cli:snake "Building Python package with build..."
        python -m build
    else
        caddie cli:warning "No Python build configuration found"
    fi
    return 0
}

function caddie_cross_build_rust() {
    if [ -f "Cargo.toml" ]; then
        caddie cli:crab "Building Rust project..."
        cargo build --release
    else
        caddie cli:warning "No Rust project found"
    fi
    return 0
}

function caddie_cross_build_ios() {
    if [ -f "*.xcodeproj" ] || [ -f "*.xcworkspace" ]; then
        caddie cli:rocket "Building iOS project..."
        caddie cli:warning "iOS build functionality not yet implemented"
    else
        caddie cli:warning "No iOS project found"
    fi
    return 0
}

function caddie_cross_mcp_dir() {
    local dir="$PWD"

    while [ -n "$dir" ] && [ "$dir" != "/" ]; do
        if [ -d "$dir/platform/mcp-server-rust" ]; then
            printf '%s\n' "$dir/platform/mcp-server-rust"
            return 0
        fi
        dir="$(dirname "$dir")"
    done

    return 1
}

# Deployment functions
function caddie_cross_deploy_docker() {
    caddie cli:whale "Creating Docker deployment setup..."
    
    # Create Dockerfile
    cat > Dockerfile << EOF
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 3000

CMD ["npm", "start"]
EOF
    
    # Create docker-compose.yml
    cat > docker-compose.yml << EOF
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    volumes:
      - .:/app
      - /app/node_modules
EOF
    
    caddie cli:check "Docker deployment setup created"
    return 0
}

function caddie_cross_deploy_local() {
    caddie cli:folder "Setting up local deployment..."
    
    # Create deployment script
    cat > deploy.sh << 'EOF'
#!/bin/bash

caddie cli:title "Deploying locally..."

# Build the project
npm run build

# Start the application
npm start
EOF
    
    chmod +x deploy.sh
    
    caddie cli:check "Local deployment setup created"
    return 0
}

function caddie_cross_deploy_railway() {
    local mcp_dir=""

    if ! command -v railway >/dev/null 2>&1; then
        caddie cli:red "Error: Railway CLI not found"
        caddie cli:indent "Install with: brew install railway or npm i -g @railway/cli"
        return 1
    fi

    mcp_dir="$(caddie_cross_mcp_dir)"
    if [ -z "$mcp_dir" ]; then
        caddie cli:red "Error: Could not locate platform/mcp-server-rust"
        caddie cli:indent "Run this from the repo root or any subdirectory."
        return 1
    fi

    caddie cli:rocket "Deploying MCP server to Railway..."
    if ! (cd "$mcp_dir" && railway up); then
        caddie cli:red "Error: Railway deploy failed"
        return 1
    fi

    caddie cli:check "Railway deploy completed"
    return 0
}

# Tools functions
function caddie_cross_tools_install() {
    caddie cli:wrench "Installing development tools..."
    
    # Install common tools
    if command -v brew >/dev/null 2>&1; then
        caddie cli:beer "Installing common tools..."
        brew install git-lfs pre-commit
    fi
    
    # Install Node.js tools
    if command -v npm >/dev/null 2>&1; then
        caddie cli:package "Installing Node.js tools..."
        npm install -g eslint prettier jest
    fi
    
    # Install Python tools
    if command -v pip3 >/dev/null 2>&1; then
        caddie cli:snake "Installing Python tools..."
        pip3 install black flake8 mypy pytest
    fi
    
    caddie cli:check "Development tools installed"
    return 0
}

function caddie_cross_tools_setup() {
    caddie cli:wrench "Setting up development tools..."
    
    # Setup git hooks
    if [ -d ".git" ]; then
        caddie cli:git "Setting up git hooks..."
        pre-commit install
    fi
    
    # Setup linting
    if [ -f "package.json" ]; then
        caddie cli:package "Setting up Node.js linting..."
        npm install --save-dev eslint prettier
    fi
    
    caddie cli:check "Development tools setup complete"
    return 0
}

function caddie_cross_tools_lint() {
    caddie cli:magnifying_glass "Running all linters..."
    
    # Python linting
    if [ -f "setup.py" ] || [ -f "pyproject.toml" ]; then
        caddie cli:snake "Running Python linters..."
        if command -v flake8 >/dev/null 2>&1; then
            flake8 src/ tests/
        fi
        if command -v mypy >/dev/null 2>&1; then
            mypy src/
        fi
    fi
    
    # Node.js linting
    if [ -f "package.json" ]; then
        caddie cli:package "Running Node.js linters..."
        if command -v eslint >/dev/null 2>&1; then
            eslint src/ tests/
        fi
    fi
    
    caddie cli:check "All linters completed"
    return 0
}

function caddie_cross_tools_format() {
    caddie cli:wrench "Formatting all code..."
    
    # Python formatting
    if [ -f "setup.py" ] || [ -f "pyproject.toml" ]; then
        caddie cli:snake "Formatting Python code..."
        if command -v black >/dev/null 2>&1; then
            black src/ tests/
        fi
    fi
    
    # Node.js formatting
    if [ -f "package.json" ]; then
        caddie cli:package "Formatting Node.js code..."
        if command -v prettier >/dev/null 2>&1; then
            prettier --write src/ tests/
        fi
    fi
    
    caddie cli:check "All code formatted"
    return 0
}

# Function to display cross-language module help
function caddie_cross_help() {
    caddie cli:title "Cross-Language Features & Templates"
    caddie cli:blank
    caddie cli:usage "caddie <command>"
    caddie cli:blank
    caddie cli:title "Environment Management:"
    caddie cli:indent "env:status         Show all environment status"
    caddie cli:indent "env:setup          Setup development environment"
    caddie cli:indent "env:reset          Reset all environments"
    caddie cli:indent "env:backup         Backup current configurations"
    caddie cli:blank
    caddie cli:title "Project Templates:"
    caddie cli:indent "template:list      List available templates"
    caddie cli:indent "template:create <type> <name>  Create from template"
    caddie cli:blank
    caddie cli:title "Available Template Types:"
    caddie cli:indent "web                Full-stack web application"
    caddie cli:indent "api                REST API with documentation"
    caddie cli:indent "mobile             Cross-platform mobile app"
    caddie cli:indent "app                iOS app"
    caddie cli:indent "framework          iOS framework"
    caddie cli:indent "extension          iOS app extension"
    caddie cli:indent "data               Data analysis project"
    caddie cli:indent "ml                 Machine learning project"
    caddie cli:indent "cli                Command-line tool"
    caddie cli:indent "lib                Library/package"
    caddie cli:indent "wasm               WebAssembly project"
    caddie cli:blank
    caddie cli:title "Build & Deploy:"
    caddie cli:indent "build:all          Build all projects"
    caddie cli:indent "build:python       Build Python package"
    caddie cli:indent "build:rust         Build Rust project"
    caddie cli:indent "build:ios          Build iOS project"
    caddie cli:indent "deploy:docker      Create Docker setup"
    caddie cli:indent "deploy:local       Local deployment"
    caddie cli:indent "deploy:railway     Deploy MCP server to Railway"
    caddie cli:blank
    caddie cli:title "Development Tools:"
    caddie cli:indent "tools:install      Install dev tools"
    caddie cli:indent "tools:setup        Setup git hooks, etc."
    caddie cli:indent "tools:lint         Run all linters"
    caddie cli:indent "tools:format       Format all code"
    caddie cli:blank
    caddie cli:title "Examples:"
    caddie cli:indent "caddie template:create web myapp"
    caddie cli:indent "caddie template:create api myapi"
    caddie cli:indent "caddie env:status"
    caddie cli:indent "caddie build:all"
    caddie cli:indent "caddie tools:lint"
    caddie cli:blank
    return 0
}

function caddie_cross_description() {
    printf '%s\n' 'Cross-Language Features & Templates'
    return 0
}

# Export cross-language functions
export -f caddie_cross_env_status
export -f caddie_cross_env_setup
export -f caddie_cross_env_reset
export -f caddie_cross_env_backup
export -f caddie_cross_template_list
export -f caddie_cross_template_create
export -f caddie_cross_template_web
export -f caddie_cross_template_api
export -f caddie_cross_template_mobile
export -f caddie_cross_template_ios_app
export -f caddie_cross_template_ios_framework
export -f caddie_cross_template_ios_extension
export -f caddie_cross_template_data
export -f caddie_cross_template_ml
export -f caddie_cross_template_cli
export -f caddie_cross_template_lib
export -f caddie_cross_template_wasm
export -f caddie_cross_build_all
export -f caddie_cross_build_python
export -f caddie_cross_build_rust
export -f caddie_cross_build_ios
export -f caddie_cross_deploy_docker
export -f caddie_cross_deploy_local
export -f caddie_cross_deploy_railway
export -f caddie_cross_tools_install
export -f caddie_cross_tools_setup
export -f caddie_cross_tools_lint
export -f caddie_cross_tools_format
export -f caddie_cross_help
export -f caddie_cross_description
