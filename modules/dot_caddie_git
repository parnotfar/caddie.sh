#!/bin/bash

# Caddie.sh - Git Prompt and Custom File Management
# This file handles git prompt setup and custom file sourcing

source "$HOME/.caddie_modules/.caddie_cli"

# Function to source custom files
caddie_source_custom_files() {
    # Source custom bash profile additions
    if [ -f "$HOME/.bash_profile-caddie-custom" ]; then
        source "$HOME/.bash_profile-caddie-custom"
    fi
    
    # Source custom bashrc additions
    if [ -f "$HOME/.bashrc-caddie-custom" ]; then
        source "$HOME/.bashrc-caddie-custom"
    fi
}

# Set product name
export PRODUCT_NAME="Caddie"

# Source and set up our prompt
source ~/.caddie_prompt.sh
set_caddie_prompt

# Auto-setup when sourced
caddie_source_custom_files

# Git workflow functions
function caddie_git_status() {
    echo "Git Status:"
    git status --short
}

function caddie_git_branch() {
    echo "Current branch: $(git branch --show-current)"
    echo "All branches:"
    git branch -a
}

function caddie_git_commit() {
    local message="$1"
    if [ -z "$message" ]; then
        echo "Error: Please provide a commit message"
        echo "Usage: caddie git:commit <message>"
        return 1
    fi
    git add .
    git commit -m "$message"
}

function caddie_git_push() {
    git push
}

function caddie_git_pull() {
    git pull
}

function caddie_git_help() {
    caddie cli:title "Git Module Commands"
    caddie cli:blank
    
    caddie cli:usage "caddie git:<command>"
    caddie cli:blank
    
    caddie cli:title "Commands:"
    caddie cli:indent "status              Show git status"
    caddie cli:indent "branch              Show current and all branches"
    caddie cli:indent "commit <message>    Add all changes and commit with message"
    caddie cli:indent "push               Push to remote repository"
    caddie cli:indent "pull               Pull from remote repository"
    caddie cli:blank
    
    caddie cli:title "Examples:"
    caddie cli:indent "caddie git:status"
    caddie cli:indent "caddie git:commit 'Add new feature'"
    caddie cli:indent "caddie git:push"
    caddie cli:blank
}

function caddie_git_description() {
    echo 'Git workflow enhancements'
}

# Export functions for external use
export -f caddie_source_custom_files
export -f caddie_git_status
export -f caddie_git_branch
export -f caddie_git_commit
export -f caddie_git_push
export -f caddie_git_pull
export -f caddie_git_help
export -f caddie_git_description