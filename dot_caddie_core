#!/bin/bash

# Caddie.sh - Core Functions
# This file contains the main caddie function and core functionality

# Default caddie home file location
CADDIE_HOME_FILE="$HOME/.caddie_home"

# Function to set the caddie home directory
function caddie_core_set_home() {
    local path="$1"
    
    if [ -z "$path" ]; then
        echo "Error: Please provide a path for caddie home"
        echo "Usage: caddie core:set:home <path>"
        return 1
    fi
    
    # Expand the path (handle ~, relative paths, etc.)
    local expanded_path=$(eval echo "$path")
    
    # Check if the path exists
    if [ ! -d "$expanded_path" ]; then
        echo "Error: Directory '$expanded_path' does not exist"
        return 1
    fi
    
    # Get the absolute path
    local absolute_path=$(cd "$expanded_path" && pwd)
    
    # Save the path to the caddie home file
    echo "$absolute_path" > "$CADDIE_HOME_FILE"
    
    export CADDIE_HOME="$absolute_path"
    
    echo "✓ Caddie home directory set to: $absolute_path"
}

# Function to get the caddie home directory
function caddie_core_get_home() {
    if [ -f "$CADDIE_HOME_FILE" ]; then
        local caddie_home=$(cat "$CADDIE_HOME_FILE")

        echo "Current caddie home: $caddie_home"
    else
        echo "No caddie home directory was set"
    fi
}

# Function to reset the caddie home directory
function caddie_core_reset_home() {
    if [ -f "$CADDIE_HOME_FILE" ]; then
        rm "$CADDIE_HOME_FILE"
        unset CADDIE_HOME
        echo "✓ Caddie home directory has been reset"
    else
        echo "No caddie home directory was set"
    fi
}

# Function to handle debug commands
function caddie_core_debug() {
    local action="$1"
    
    case "$action" in
        "on")
            caddie_debug_on
            echo "✓ Debug mode enabled"
            ;;
        "off")
            caddie_debug_off
            echo "✓ Debug mode disabled"
            ;;
        "toggle")
            caddie_debug_toggle
            echo "✓ Debug mode toggled to: $(caddie_debug_status)"
            ;;
        "status")
            echo "Debug mode is: $(caddie_debug_status)"
            ;;
        *)
            echo "Error: Invalid debug action '$action'"
            echo "Usage: caddie core:debug <on|off|toggle|status>"
            return 1
            ;;
    esac
}



# Function to show core caddie help
function caddie_core_help() {
    echo "Core Caddie Functions"
    echo "===================="
    echo ""
    echo "Usage: caddie core:<command>"
    echo ""
    echo "Home Directory Management:"
echo "  set:home <path>     Set caddie home directory"
echo "  get:home            Get current caddie home"
echo "  reset:home          Reset caddie home directory"
echo ""
echo "Debug Management:"
echo "  debug:on            Enable debug output"
echo "  debug:off           Disable debug output"
echo "  debug:toggle        Toggle debug output"
echo "  debug:status        Show debug status"
    echo ""
    echo "Examples:"
    echo "  caddie core:set:home ~/projects/myproject"
    echo "  caddie core:get:home"
    echo "  caddie core:reset:home"
}

function caddie_core_description() {
    echo 'Core Caddie Functions'
}

# Auto-load caddie home on shell startup
if [ -f "$CADDIE_HOME_FILE" ]; then
    caddie_home=$(cat "$CADDIE_HOME_FILE")
    export CADDIE_HOME="$caddie_home"
fi

# Export core functions
export -f caddie_core_set_home
export -f caddie_core_get_home
export -f caddie_core_reset_home
export -f caddie_core_help
export -f caddie_core_description
export -f caddie_core_debug